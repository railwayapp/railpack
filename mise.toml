[env]
BUILDKIT_HOST = "docker-container://buildkit"
_.path = './bin'

[tasks.setup]
run = [
  "mise install",
  "docker run --rm --privileged -d --name buildkit moby/buildkit || true",
  "mise run tidy",
]

[tasks.cli]
run = "go run cmd/cli/main.go"

[tasks.debug-cli]
run = "dlv debug github.com/railwayapp/railpack/cmd/cli --"

[tasks.build]
run = "go build -o bin/railpack cmd/cli/main.go"

[tasks.clean]
run = "rm -rf bin dist docs/dist"

[tasks.test]
run = "go test -short ./..."

[tasks.test-integration]
run = "go test -v ./integration_tests"

[tasks.test-update-snapshots]
run = "UPDATE_SNAPS=true go test -short ./..."

[tasks.check]
run = """
go vet ./...
go fmt ./...
golangci-lint run
"""

[tasks.tidy]
run = "go mod tidy"

[tasks.docs-build]
dir = "docs"
run = "bun run build"

[tasks.docs-dev]
dir = "docs"
run = "bun run dev"

[tools]
go = "1.23.4"
golangci-lint = "1.63.4"
bun = "1.2"
node = "22"
"go:github.com/wagoodman/dive" = "latest"
"go:github.com/go-delve/delve/cmd/dlv" = "latest"

[settings]
experimental = true
